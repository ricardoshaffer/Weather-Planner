<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://api.mqcdn.com/sdk/mapquest-js/v1.3.1/mapquest.js"></script>     
    <link type="text/css" rel="stylesheet" href="https://api.mqcdn.com/sdk/mapquest-js/v1.3.1/mapquest.css"/> 
    <title>Document</title>
</head>
<body>
    <div id="map" style="width: 100%; height: 530px;"></div>
    <p id="mapperID"></p>
    <form>
        <input class="uk-input uk-form-width-medium uk-form-large" id="activitySearch" type="text" placeholder="Enter state Code">
    </form>
    <script>
        getLocation();
let locatorText = document.getElementById("mapperID");
function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition);
  } else { 
    locatorText.innerHTML = "Geolocation is not supported by this browser.";
  }
}

function showPosition(position) {
    locatorText.innerHTML = "Latitude: " + position.coords.latitude + 
  "<br>Longitude: " + position.coords.longitude;

        L.mapquest.key = 'm6r48gcKnaiZ5cS9fynPUC8mEcXnoOjO';
        let map = L.mapquest.map('map', {
          center: [position.coords.latitude, position.coords.longitude],
          layers: L.mapquest.tileLayer('map'),
          zoom: 14
        });
        L.marker([position.coords.latitude, position.coords.longitude], {
          icon: L.mapquest.icons.marker(),
          draggable: false
        }).bindPopup('You').addTo(map);
}





//         let lococo = document.getElementById("maplocation");
// function getLocation() {
//   if (navigator.geolocation) {
//     navigator.geolocation.getCurrentPosition(showPosition);
//   } else {
//     lococo.innerHTML = "Geolocation is not supported by this browser.";
//   }
// }

// function showPosition(position) {
//     lococo.innerHTML = "Latitude: " + position.coords.latitude +
//   "<br>Longitude: " + position.coords.longitude;
//     function mapLoaded(){
//         L.mapquest.key = 'm6r48gcKnaiZ5cS9fynPUC8mEcXnoOjO';
//         let map = L.mapquest.map('map', {
//           center: [position.coords.latitude, position.coords.longitude],
//           layers: L.mapquest.tileLayer('map'),
//           zoom: 14
//         });
//         L.marker([position.coords.latitude, position.coords.longitude], {
//           icon: L.mapquest.icons.marker(),
//           draggable: false
//         }).bindPopup('You').addTo(map);
//     }
// }


        // $.get('https://ipapi.co/ip/', function(data){
        //     let ipFetched = data;
        //     console.log(ipFetched);
        //     let ipEmbed = "https://ipapi.co/" + ipFetched + "/json/";
        // $.getJSON(ipEmbed, function(data){
        //     let ipTrace = data;
        //     console.log(ipTrace);
        //     locationLat = ipTrace.latitude
        //     locationLong = ipTrace.longitude;
        //     console.log("locationLatitude: " + locationLat + " , " + "locationLongitude: " + locationLong)
        //             ///// MAPQUEST TRIAL RUN ///////////////

    //   function mapLoaded() {
    //     L.mapquest.key = 'm6r48gcKnaiZ5cS9fynPUC8mEcXnoOjO';

    //     let map = L.mapquest.map('map', {
    //       center: [locationLat, locationLong],
    //       layers: L.mapquest.tileLayer('map'),
    //       zoom: 14
    //     });
    //     L.marker([locationLat, locationLong], {
    //       icon: L.mapquest.icons.marker(),
    //       draggable: false
    //     }).bindPopup('You').addTo(map);
    // }
    //     mapLoaded();



////// END MAPQUEST TRIAL RUN ///////////












// })})
        document.addEventListener("keypress", function(event){
    if(event.key === 'Enter' || event.key === 'Return'){
        event.preventDefault();
        let activityName = document.getElementById("activitySearch");
        let textBox = document.querySelector("#activitySearch");
        queryActivity = activityName.value;

let limitResults = "&limit=50";
let apiKey = "C20X2gP148EDeslk7stqM8BU6u6WmOqbAdPeKG8C";
let queryURL = "https://developer.nps.gov/api/v1/places?stateCode"+ queryActivity +"&limit=5&api_key=C20X2gP148EDeslk7stqM8BU6u6WmOqbAdPeKG8C";

//var queryURL = "https://ridb.recreation.gov/api/v1/activities?query=" + queryActivity + limitResults + "&limit=5&api_key=" +apiKey;
    
$.ajax({ //
    url: queryURL, 
    method: "GET"
}).then(function(response){
    let npsResponse = response;
    console.log(npsResponse);
    for(entry=0; entry < 10; entry++){
        parkTitle = npsResponse.data[entry].name;
        parkLatLong = (npsResponse.data[entry].latLong).replace("{", "").replace("}","");
        if(parkLatLong != ''){
        parkLatLong = parkLatLong.split(',');
        parkLat = (parkLatLong[0])
        let parkLatClean = parkLat.replace("lat:", "");
        parkLong = (parkLatLong[1])
        let parkLongClean = parkLong.replace("lng:", "");
        console.log("parkTitle response: " + parkTitle+ ", latLong: "+ parkLatLong + "parkLatClean: "+ parkLatClean + ", parkLongClean: "+ parkLongClean);
    mapKey = ("https://www.mapquestapi.com/search/v4/place?location=" + parkLongClean + "%2C" + parkLatClean + "&sort=distance&feedback=false&key=m6r48gcKnaiZ5cS9fynPUC8mEcXnoOjO&q=coffee");
    console.log("mapKey: "+mapKey);
    $.ajax({
    url: mapKey,
    method: "GET"
}).then(function(response){
    let mapQResponse = response;
    console.log(mapQResponse)
})
    }
    }

    }
)
// // $.ajax(settings).done(function (response) {
// //   console.log(response);
// // });




        
//     //     console.log(queryActivity);

//     //     $.ajax({
//     //     url: queryURL,
//     //     beforeSend: function(xhr) {
//     //          xhr.setRequestHeader("apikey", apiKey)
//     //     }, success: function(data){
//     //         alert(data);
//     //         //process the JSON data etc
//     //     },
//     //     method: "GET"
//     //     ,then: function(response){
//     // console.log("current activity Response: " + response);
//     //     }})
//     // }
//     }})
    </script>
</body>
</html>